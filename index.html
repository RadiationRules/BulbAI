<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BulbAI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#f8f9fa;
  --panel:#fff;
  --accent:#f7c948;
  --accent-dark:#e6bd00;
  --text:#1f1f1f;
  --muted:#6b6b6b;
  --shadow:rgba(0,0,0,0.1);
  --radius:12px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body, html{height:100%;font-family:'Inter',sans-serif;background:var(--bg);}
a{text-decoration:none;color:var(--accent);}
a:hover{text-decoration:underline;}
button{cursor:pointer;}

/* LOGIN SCREEN */
#loginScreen{
  position:relative;display:flex;justify-content:center;align-items:center;height:100%;width:100%;overflow:hidden;
}
#loginScreen video{
  position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;filter:brightness(0.25);z-index:0;
}
.login-container{
  position:relative;z-index:1;background:rgba(255,255,255,0.9);padding:2rem;border-radius:var(--radius);
  width:100%;max-width:400px;display:flex;flex-direction:column;gap:1rem;text-align:center;box-shadow:0 8px 24px var(--shadow);
}
.login-container h1{font-size:2rem;color:var(--text);}
.login-container p{color:var(--muted);font-size:0.9rem;}
.input-group{display:flex;flex-direction:column;gap:0.5rem;}
.input-group input{padding:0.75rem;border-radius:var(--radius);border:1px solid rgba(0,0,0,0.2);font-size:1rem;}
.button{padding:0.75rem;border-radius:var(--radius);border:none;background:var(--accent);color:#2b2b2b;font-weight:700;transition:0.3s;display:flex;justify-content:center;align-items:center;gap:0.5rem;}
.button:hover{transform:scale(1.03);}
.google-btn{background:#fff;border:1px solid #ddd;color:#000;}
.google-btn img{height:20px;}
.divider{position:relative;margin:0.5rem 0;color:var(--muted);}
.divider::before,.divider::after{content:"";position:absolute;top:50%;width:40%;height:1px;background:var(--shadow);}
.divider::before{left:0;}
.divider::after{right:0;}
.try-btn{font-weight:700;text-decoration:underline;margin-top:0.5rem;color:var(--accent);cursor:pointer;}

/* CHAT INTERFACE */
#mainApp{display:none;height:100vh;width:100%;flex-direction:column;}
.app{display:grid;grid-template-columns:320px 1fr;gap:16px;height:100%;}
.sidebar{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08);display:flex;flex-direction:column;}
.brand{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
.logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#f7c948,#ffd86b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#2b2b2b;font-size:18px;}
#newChatBtn{margin-bottom:16px;}
.sidebar-footer{margin-top:16px;display:flex;gap:8px;justify-content:space-between;}
.main{display:flex;flex-direction:column;gap:12px;}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.08);}
.chat-window{flex:1;background:#fef8e6;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:12px;overflow:auto;box-shadow:0 6px 18px rgba(0,0,0,0.08);scroll-behavior:smooth;}
.composer{display:flex;gap:8px;align-items:center;padding:12px;border-radius:12px;background:#fff;}
.composer input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.1);}
.msg{max-width:72%;padding:10px 14px;border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,0.03);transform:scale(0.95);opacity:0;animation:popIn 0.25s forwards;}
.msg.user{background:linear-gradient(90deg,#ffe37f,#fff6c6);align-self:flex-end;}
.msg.bot{background:linear-gradient(90deg,#fff7e0,#fff);align-self:flex-start;}
@keyframes popIn{to{transform:scale(1);opacity:1;}}
.typing{display:flex;gap:6px;align-items:center;background:rgba(0,0,0,0.05);padding:8px 12px;border-radius:12px;width:max-content;animation:pulse 1s infinite;}
.typing span{width:6px;height:6px;background:#f7c948;border-radius:50%;display:inline-block;animation:bounce 1s infinite;}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
@keyframes pulse{0%,100%{opacity:0.8;}50%{opacity:1;}}
/* Responsive */
@media(max-width:768px){.app{grid-template-columns:1fr;}.sidebar{flex-direction:row;overflow-x:auto;}.main{margin-top:8px;}}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <video autoplay loop muted playsinline>
    <source src="https://cdn.jsdelivr.net/gh/RadiationRules/BulbAI-assets/terminal.mp4" type="video/mp4">
  </video>
  <div class="login-container">
    <h1>ðŸ’¡ BulbAI</h1>
    <p>Sign in to continue</p>
    <button id="googleSignInBtn" class="button google-btn">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo"> Sign in with Google
    </button>
    <div class="divider">OR</div>
    <div class="input-group">
      <input type="email" id="emailInput" placeholder="Email">
      <input type="password" id="passwordInput" placeholder="Password">
    </div>
    <button id="emailSignInBtn" class="button">Sign In</button>
    <button id="emailSignUpBtn" class="button">Sign Up</button>
    <div class="try-btn" id="tryBtn">Try it Out</div>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp">
  <div class="app">
    <aside class="sidebar">
      <div class="brand"><div class="logo">ðŸ’¡</div><div><h2>BulbAI</h2><div style="font-size:12px;color:#6b6b6b;">Your yellow assistant</div></div></div>
      <button id="newChatBtn" class="button">+ New Chat</button>
      <div id="conversationsList" style="flex:1;display:flex;flex-direction:column;gap:8px;overflow:auto;"></div>
      <div class="sidebar-footer">
        <button id="themeToggle" class="button google-btn">Settings</button>
      </div>
    </aside>
    <main class="main">
      <div class="topbar">
        <div class="left">
          <div class="title" id="convTitle">New Chat</div>
          <div class="tiny muted" id="convSubtitle" style="font-size:12px;color:#6b6b6b;">No messages yet</div>
        </div>
      </div>
      <div id="chatWindow" class="chat-window">
        <div class="messages" id="messages"></div>
      </div>
      <div class="composer">
        <input id="prompt" placeholder="Type a message...">
        <button id="attachBtn" class="button">+</button>
        <button id="sendBtn" class="button">Send</button>
        <input type="file" id="attachFileInput" accept="image/*" style="display:none;">
      </div>
    </main>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="modalBackdrop" class="modal-backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:50;">
  <div class="modal" style="background:#fff;padding:18px;border-radius:12px;min-width:320px;max-width:90%;display:flex;flex-direction:column;gap:12px;">
    <h3>Settings & Utilities</h3>
    <div class="row" style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <label class="small" style="min-width:84px;">Theme</label>
      <button id="toggleThemeBtn" class="button google-btn">Toggle Dark/Light</button>
    </div>
    <div class="row" style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <button id="clearChatsBtn" class="button google-btn">Clear All Conversations</button>
      <button id="closeModalBtn" class="button google-btn">Close</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

const firebaseConfig = {
  apiKey:"YOUR_FIREBASE_API_KEY",
  authDomain:"YOUR_FIREBASE_AUTH_DOMAIN",
  projectId:"YOUR_PROJECT_ID",
  storageBucket:"YOUR_BUCKET",
  messagingSenderId:"YOUR_SENDER_ID",
  appId:"YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const loginScreen = document.getElementById('loginScreen');
const mainApp = document.getElementById('mainApp');
const tryBtn = document.getElementById('tryBtn');
const googleBtn = document.getElementById('googleSignInBtn');
const emailSignInBtn = document.getElementById('emailSignInBtn');
const emailSignUpBtn = document.getElementById('emailSignUpBtn');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');

onAuthStateChanged(auth,user=>{
  if(user){
    loginScreen.style.display='none';
    mainApp.style.display='flex';
  }else{
    loginScreen.style.display='flex';
    mainApp.style.display='none';
  }
});

tryBtn.onclick = ()=>{loginScreen.style.display='none'; mainApp.style.display='flex';};

googleBtn.onclick = ()=>{
  const provider=new GoogleAuthProvider();
  signInWithPopup(auth,provider).then(r=>alert(`Welcome ${r.user.displayName}`)).catch(e=>alert(e.message));
};

emailSignInBtn.onclick = ()=>{
  signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value)
    .then(r=>alert(`Welcome ${r.user.email}`))
    .catch(e=>alert(e.message));
};

emailSignUpBtn.onclick = ()=>{
  createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value)
    .then(r=>alert(`Account created: ${r.user.email}`))
    .catch(e=>alert(e.message));
};

/* ================== Chat Logic ================== */
const newChatBtn = document.getElementById('newChatBtn');
const messagesEl = document.getElementById('messages');
const promptEl = document.getElementById('prompt');
const sendBtn = document.getElementById('sendBtn');
const attachBtn = document.getElementById('attachBtn');
const attachInput = document.getElementById('attachFileInput');
const convTitle = document.getElementById('convTitle');
const conversationsList = document.getElementById('conversationsList');
let conversations=[];

function createMessageElement(content,type='bot'){
  const msg = document.createElement('div');
  msg.className=`msg ${type}`;
  msg.textContent=content;
  return msg;
}

function sendMessage(content){
  const userMsg=createMessageElement(content,'user');
  messagesEl.appendChild(userMsg);
  messagesEl.scrollTop=messagesEl.scrollHeight;

  const typing=document.createElement('div');typing.className='typing';
  typing.innerHTML='<span></span><span></span><span></span>';
  messagesEl.appendChild(typing);messagesEl.scrollTop=messagesEl.scrollHeight;

  setTimeout(()=>{
    typing.remove();
    const botMsg=createMessageElement("BulbAI response to: "+content,'bot');
    messagesEl.appendChild(botMsg);
    messagesEl.scrollTop=messagesEl.scrollHeight;
    saveConversation(convTitle.textContent);
  },1200+Math.random()*1000);
}

sendBtn.onclick = ()=>{
  if(promptEl.value.trim()!==''){sendMessage(promptEl.value);promptEl.value='';}
};

attachBtn.onclick = ()=>attachInput.click();
attachInput.onchange=(e)=>{
  const file=e.target.files[0];
  if(file && file.type.startsWith('image/')){
    const reader=new FileReader();
    reader.onload=function(evt){
      const img=document.createElement('img');
      img.src=evt.target.result;img.style.maxWidth='200px';
      messagesEl.appendChild(img);messagesEl.scrollTop=messagesEl.scrollHeight;
    }
    reader.readAsDataURL(file);
  }
};

function addConversation(title){
  const div=document.createElement('div');
  div.textContent=title;
  div.style.padding='8px';div.style.borderRadius='8px';div.style.background='#fef8e6';div.style.cursor='pointer';
  div.onmouseenter=()=>div.style.background='#fff6c6';
  div.onmouseleave=()=>div.style.background='#fef8e6';
  div.onclick=()=>{
    messagesEl.innerHTML='';convTitle.textContent=title;
    const data=JSON.parse(localStorage.getItem('bulbai_conversations')||'[]');
    const convo=data.find(d=>d.title===title);
    if(convo)convo.messages.forEach(m=>{
      const msgEl=createMessageElement(m.content,m.type);
      messagesEl.appendChild(msgEl);
    });
  }
  conversationsList.appendChild(div);conversations.push(title);
}

newChatBtn.onclick=()=>{
  messagesEl.innerHTML='';
  const newTitle='Chat '+(conversations.length+1);
  convTitle.textContent=newTitle;
  addConversation(newTitle);
}

function saveConversation(title){
  let data=JSON.parse(localStorage.getItem('bulbai_conversations')||'[]');
  const msgs=Array.from(messagesEl.children).filter(el=>el.classList.contains('msg')).map(el=>({content:el.textContent,type:el.classList.contains('user')?'user':'bot'}));
  const existing=data.find(d=>d.title===title);
  if(existing){existing.messages=msgs;}else{data.push({title:title,messages:msgs});}
  localStorage.setItem('bulbai_conversations',JSON.stringify(data));
}

(function loadConversations(){
  const saved=JSON.parse(localStorage.getItem('bulbai_conversations')||'[]');
  saved.forEach(c=>addConversation(c.title));
})();
</script>
</body>
</html>
