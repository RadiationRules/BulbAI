<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BulbAI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ========================
   VARIABLES & RESET
======================== */
:root {
  --bg: #f8f9fa;
  --panel: #ffffff;
  --accent: #f7c948;
  --accent-dark: #e6bd00;
  --text: #1f1f1f;
  --muted: #6b6b6b;
  --shadow: rgba(0,0,0,0.1);
  --radius: 12px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body, html{height:100%;font-family:'Inter',sans-serif;background:var(--bg);}
a{text-decoration:none;color:var(--accent);}
a:hover{text-decoration:underline;}

/* ========================
   LOGIN SCREEN
======================== */
#loginScreen {
  display:flex;
  justify-content:center;
  align-items:center;
  height:100%;
  width:100%;
  background:var(--bg);
}
.login-container {
  background: var(--panel);
  padding:2rem;
  border-radius: var(--radius);
  box-shadow:0 8px 24px var(--shadow);
  width:100%;
  max-width:400px;
  display:flex;
  flex-direction:column;
  gap:1.5rem;
  animation:fadeIn 0.5s ease forwards;
}
.login-container h1 {
  text-align:center;
  font-size:2rem;
  color:var(--text);
}
.login-container p {
  text-align:center;
  color:var(--muted);
  font-size:0.9rem;
}
.input-group {display:flex;flex-direction:column;gap:0.5rem;}
.input-group input {
  padding:0.75rem;
  border-radius: var(--radius);
  border:1px solid rgba(0,0,0,0.1);
  font-size:1rem;
}
.button {
  padding:0.75rem;
  border-radius: var(--radius);
  border:none;
  background:var(--accent);
  color:#2b2b2b;
  font-weight:700;
  cursor:pointer;
  transition:0.3s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.5rem;
}
.button:hover {transform:scale(1.03);}
.google-btn {background:#fff;border:1px solid #ddd;color:#000;}
.google-btn img {height:20px;width:20px;}
.divider {
  text-align:center;
  color:var(--muted);
  margin:0.5rem 0;
  position:relative;
}
.divider::before, .divider::after {
  content:"";
  position:absolute;
  top:50%;
  width:40%;
  height:1px;
  background:var(--shadow);
}
.divider::before {left:0;}
.divider::after {right:0;}

/* ========================
   ANIMATIONS
======================== */
@keyframes fadeIn {
  from {opacity:0; transform:scale(0.95);}
  to {opacity:1; transform:scale(1);}
}

/* ========================
   RESPONSIVE
======================== */
@media(max-width:500px){
  .login-container {padding:1.5rem;}
  .login-container h1 {font-size:1.75rem;}
  .input-group input {font-size:0.95rem;}
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-container">
    <h1>ðŸ’¡ BulbAI</h1>
    <p>Sign in to continue</p>

    <button id="googleSignInBtn" class="button google-btn">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Logo"> Sign in with Google
    </button>

    <div class="divider">OR</div>

    <div class="input-group">
      <input type="email" id="emailInput" placeholder="Email">
      <input type="password" id="passwordInput" placeholder="Password">
    </div>
    <button id="emailSignInBtn" class="button">Sign In</button>
    <button id="emailSignUpBtn" class="button">Sign Up</button>
    <p style="text-align:center;">Don't have an account? <a href="#">Sign up</a></p>
  </div>
</div>

<!-- ========================
   FIREBASE SCRIPT
======================== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCGFij1pFUVNFP63QHxEq619c9jPnskzxY",
  authDomain: "bulbai-21f09.firebaseapp.com",
  projectId: "bulbai-21f09",
  storageBucket: "bulbai-21f09.appspot.com",
  messagingSenderId: "366775652166",
  appId: "1:366775652166:web:22db16f4f87f9a60625f47",
  measurementId: "G-G09FQQ53XP"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Elements
const googleBtn = document.getElementById('googleSignInBtn');
const emailSignInBtn = document.getElementById('emailSignInBtn');
const emailSignUpBtn = document.getElementById('emailSignUpBtn');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const loginScreen = document.getElementById('loginScreen');
const mainApp = document.getElementById('mainApp');

// Google Sign-In
googleBtn.onclick = () => {
  const provider = new GoogleAuthProvider();
  signInWithPopup(auth, provider)
    .then((result) => {
      alert(`Welcome ${result.user.displayName}`);
      showMainApp();
    })
    .catch((error) => alert(error.message));
};

// Email Sign-In
emailSignInBtn.onclick = () => {
  signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
    .then((userCredential) => {
      alert(`Welcome ${userCredential.user.email}`);
      showMainApp();
    })
    .catch((error) => alert(error.message));
};

// Email Sign-Up
emailSignUpBtn.onclick = () => {
  createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
    .then((userCredential) => {
      alert(`Account created: ${userCredential.user.email}`);
      showMainApp();
    })
    .catch((error) => alert(error.message));
};

// Show main app
function showMainApp(){
  loginScreen.style.display='none';
  mainApp.style.display='flex';
}
</script>

<!-- ========================
   BULBAI MAIN CHAT INTERFACE
======================== -->
<div id="mainApp" style="display:none;height:100vh;width:100%;flex-direction:column;">
  <div class="app" style="display:grid;grid-template-columns:320px 1fr;gap:16px;height:100%;">
    <!-- Sidebar -->
    <aside class="sidebar" style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08);display:flex;flex-direction:column;">
      <div class="brand" style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
        <div class="logo" style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#f7c948,#ffd86b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#2b2b2b;font-size:18px;">ðŸ’¡</div>
        <div>
          <h2 style="font-size:16px;margin:0;">BulbAI</h2>
          <div style="font-size:12px;color:#6b6b6b;">Your yellow assistant</div>
        </div>
      </div>

      <button id="newChatBtn" class="button" style="margin-bottom:16px;">+ New Chat</button>
      <div id="conversationsList" style="flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px;"></div>
      <div class="sidebar-footer" style="margin-top:16px;display:flex;gap:8px;justify-content:space-between;">
        <button id="themeToggle" class="button google-btn">Dark Mode</button>
      </div>
    </aside>

    <!-- Main Chat Window -->
    <main class="main" style="display:flex;flex-direction:column;gap:12px;">
      <div class="topbar" style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.08);">
        <div class="left">
          <div class="title" id="convTitle" style="font-weight:700;">New Chat</div>
          <div class="tiny muted" id="convSubtitle" style="font-size:12px;color:#6b6b6b;">No messages yet</div>
        </div>
      </div>

      <div id="chatWindow" class="chat-window" style="flex:1;background:#fef8e6;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:12px;overflow:auto;box-shadow:0 6px 18px rgba(0,0,0,0.08);">
        <div class="messages" id="messages" style="display:flex;flex-direction:column;gap:12px;"></div>
      </div>

      <div class="composer" style="display:flex;gap:8px;align-items:center;padding:12px;border-radius:12px;background:#fff;">
        <input id="prompt" placeholder="Type a message..." style="flex:1;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.1);" />
        <button id="sendBtn" class="button">Send</button>
      </div>
    </main>
  </div>
</div>

<script type="module">
// ========================
// BULBAI CHAT LOGIC + OPENAI
// ========================
const messagesEl = document.getElementById('messages');
const promptEl = document.getElementById('prompt');
const sendBtn = document.getElementById('sendBtn');
const convTitle = document.getElementById('convTitle');
const conversationsList = document.getElementById('conversationsList');
let conversations=[];

// Typing indicator
const typingIndicator = document.createElement('div');
typingIndicator.className='typing';
typingIndicator.innerHTML='<span></span><span></span><span></span>';
typingIndicator.style.margin='6px 0';
function showTyping(){messagesEl.appendChild(typingIndicator);messagesEl.scrollTop=messagesEl.scrollHeight;}
function hideTyping(){if(messagesEl.contains(typingIndicator)){messagesEl.removeChild(typingIndicator);}}

// OpenAI API key
const OPENAI_API_KEY = 'YOUR_OPENAI_KEY_HERE'; // put your key

// Create message element
function createMessageElement(text,type){
  const div=document.createElement('div');
  div.className='msg '+type;
  div.style.maxWidth='72%';
  div.style.padding='10px 14px';
  div.style.borderRadius='14px';
  div.style.boxShadow='0 6px 14px rgba(0,0,0,0.03)';
  div.style.alignSelf = type==='user'?'flex-end':'flex-start';
  div.textContent=text;
  return div;
}

// Send message to AI
async function sendMessage(text){
  const userMsgEl = createMessageElement(text,'user');
  messagesEl.appendChild(userMsgEl);
  messagesEl.scrollTop = messagesEl.scrollHeight;

  showTyping();

  try{
    const response = await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':`Bearer ${OPENAI_API_KEY}`
      },
      body:JSON.stringify({
        model:'gpt-3.5-turbo',
        messages:[
          {role:'system', content:'You are BulbAI, a professional AI assistant.'},
          {role:'user', content:text}
        ],
        temperature:0.7,
        max_tokens:500
      })
    });
    const data = await response.json();
    const aiText = data.choices[0].message.content.trim();

    hideTyping();
    const botMsgEl = createMessageElement(aiText,'bot');
    messagesEl.appendChild(botMsgEl);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    saveConversation(convTitle.textContent);
  }catch(err){
    hideTyping();
    const errorMsg = createMessageElement('Error connecting to AI: '+err.message,'bot');
    messagesEl.appendChild(errorMsg);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
}

// Send button
sendBtn.onclick = () => {
  if(promptEl.value.trim()!==''){
    sendMessage(promptEl.value);
    promptEl.value='';
  }
};

// ========================
// CONVERSATION MANAGEMENT
// ========================
function addConversation(title){
  const div=document.createElement('div');
  div.textContent=title;
  div.style.padding='8px';
  div.style.borderRadius='8px';
  div.style.background='#fef8e6';
  div.style.cursor='pointer';
  div.onmouseenter = ()=>div.style.background='#fff6c6';
  div.onmouseleave = ()=>div.style.background='#fef8e6';
  div.onclick = ()=>{
    messagesEl.innerHTML='';
    convTitle.textContent=title;
    const data = JSON.parse(localStorage.getItem('bulbai_conversations')||'[]');
    const convo = data.find(d=>d.title===title);
    if(convo){convo.messages.forEach(m=>{const msgEl=createMessageElement(m.content,m.type);messagesEl.appendChild(msgEl);});}
  }
  conversationsList.appendChild(div);
  conversations.push(title);
}

document.getElementById('newChatBtn').onclick = ()=>{
  messagesEl.innerHTML='';
  const newTitle='Chat '+(conversations.length+1);
  convTitle.textContent=newTitle;
  addConversation(newTitle);
}

function saveConversation(title){
  let data=JSON.parse(localStorage.getItem('bulbai_conversations')||'[]');
  const messagesArray=Array.from(messagesEl.children)
    .filter(el=>el.classList.contains('msg'))
    .map(el=>({content:el.textContent,type:el.classList.contains('user')?'user':'bot'}));
  const existing=data.find(d=>d.title===title);
  if(existing){existing.messages=messagesArray;}else{data.push({title:title,messages:messagesArray});}
  localStorage.setItem('bulbai_conversations',JSON.stringify(data));
}

// Load conversations
function loadConversations(){
  const saved=localStorage.getItem('bulbai_conversations');
  if(saved){
    const data=JSON.parse(saved);
    data.forEach(c=>addConversation(c.title));
  }
}
loadConversations();
</script>

<style>
/* ========================
   CHAT MESSAGES & TYPING
======================== */
.msg.user {background:linear-gradient(90deg,#ffe37f,#fff6c6);}
.msg.bot {background:linear-gradient(90deg,#fff7e0,#fff);}
.msg {transform:scale(0.95);opacity:0;animation:popIn 0.25s forwards;}
@keyframes popIn {to{transform:scale(1);opacity:1;}}
.typing{display:flex;gap:6px;align-items:center;background:rgba(0,0,0,0.05);padding:8px 12px;border-radius:12px;width:max-content;animation:pulse 1s infinite;}
.typing span{width:6px;height:6px;background:#f7c948;border-radius:50%;display:inline-block;animation:bounce 1s infinite;}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
@keyframes pulse{0%,100%{opacity:0.8;}50%{opacity:1;}}
</style>

</body>
</html>
