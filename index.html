<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BulbAI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f8f9fa;
  --panel: #ffffff;
  --accent: #f7c948;
  --accent-dark: #e6bd00;
  --text: #1f1f1f;
  --muted: #6b6b6b;
  --shadow: rgba(0,0,0,0.1);
  --radius: 12px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body, html{height:100%;font-family:'Inter',sans-serif;background:var(--bg);}
a{text-decoration:none;color:var(--accent);}
a:hover{text-decoration:underline;}
.dark-mode{background:#1b1b1b;color:#eee;}
.dark-mode .panel{background:#2a2a2a;color:#eee;}
.panel{background:var(--panel);border-radius:var(--radius);padding:16px;box-shadow:0 8px 24px var(--shadow);}
button{cursor:pointer;border:none;border-radius:var(--radius);padding:8px 12px;background:var(--accent);font-weight:600;transition:0.3s;}
button:hover{transform:scale(1.05);}
input{padding:8px;border-radius:var(--radius);border:1px solid #ccc;flex:1;}
/* Login styles */
#loginScreen{position:relative;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;}
#loginScreen video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(0.35);}
.login-container{z-index:10;width:100%;max-width:400px;display:flex;flex-direction:column;gap:1rem;}
.google-btn{display:flex;align-items:center;gap:8px;background:#fff;color:#000;}
.google-btn img{width:20px;height:20px;display:inline-block;}
.try-btn{text-decoration:underline;font-weight:700;background:none;color:#fff;border:none;}
/* App layout */
#mainApp{display:none;height:100vh;width:100%;overflow:hidden;}
.app{display:grid;grid-template-columns:320px 1fr;gap:12px;height:100%;transition:margin 0.3s;}
.sidebar{background:#fff;padding:16px;display:flex;flex-direction:column;gap:12px;box-shadow:0 0 10px var(--shadow);}
.sidebar button{width:100%;}
.chat-window{flex:1;overflow-y:auto;padding:16px;border-radius:var(--radius);background:#fef8e6;}
.composer{display:flex;align-items:center;gap:8px;padding:12px;background:#fff;border-radius:var(--radius);}
.composer input{flex:1;}
.msg{padding:10px 14px;border-radius:14px;max-width:70%;margin-bottom:8px;box-shadow:0 4px 10px rgba(0,0,0,0.05);}
.msg.user{background:linear-gradient(90deg,#ffe37f,#fff6c6);align-self:flex-end;}
.msg.bot{background:linear-gradient(90deg,#fff7e0,#fff);align-self:flex-start;}
/* Settings panel */
.settings-panel{position:fixed;top:0;right:-300px;width:300px;height:100%;background:#fff;box-shadow:-4px 0 20px rgba(0,0,0,0.2);padding:16px;transition:0.3s;z-index:50;}
.settings-panel.show{right:0;}
.settings-btn{position:absolute;top:16px;right:16px;background:#f7c948;padding:8px;border-radius:50%;z-index:60;}
/* Typing indicator */
.typing{display:flex;gap:6px;align-items:center;padding:8px;border-radius:12px;}
.typing span{width:6px;height:6px;background:#f7c948;border-radius:50%;animation: bounce 1s infinite;}
.typing span:nth-child(2){animation-delay:0.2s;} .typing span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <video autoplay muted loop>
    <source src="https://cdn.pixabay.com/vimeo/561312234/code_typing.mp4" type="video/mp4">
  </video>
  <div class="login-container panel">
    <h1>üí° BulbAI</h1>
    <button id="googleSignInBtn" class="google-btn">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google"> Sign in with Google
    </button>
    <div style="text-align:center;"><button id="tryBtn" class="try-btn">Try it Out</button></div>
    <div class="input-group">
      <input type="email" id="emailInput" placeholder="Email">
      <input type="password" id="passwordInput" placeholder="Password">
      <button id="emailSignInBtn">Sign In</button>
      <button id="emailSignUpBtn">Sign Up</button>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp">
  <div class="app" id="appContainer">
    <aside class="sidebar">
      <h2>BulbAI</h2>
      <button id="newChatBtn">+ New Chat</button>
      <div id="conversationsList" style="flex:1;overflow:auto;"></div>
      <button id="sidebarToggle">Toggle Sidebar</button>
    </aside>
    <main style="display:flex;flex-direction:column;height:100%;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:700;font-size:18px;">üí° BulbAI</div>
        <img id="userProfile" src="https://i.ibb.co/2NwXcMz/lightbulb.png" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
      </div>
      <div id="chatWindow" class="chat-window"></div>
      <div class="composer">
        <button id="attachBtn">+</button>
        <input id="prompt" placeholder="Type a message...">
        <button id="sendBtn">‚û°Ô∏è</button>
        <input type="file" id="fileInput" style="display:none;">
      </div>
    </main>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div class="settings-panel" id="settingsPanel">
  <h3>Settings</h3>
  <button id="toggleDarkMode">Toggle Dark Mode</button>
  <button id="clearChats">Clear Chats</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCGFij1pFUVNFP63QHxEq619c9jPnskzxY",
  authDomain: "bulbai-21f09.firebaseapp.com",
  projectId: "bulbai-21f09",
  storageBucket: "bulbai-21f09.firebasestorage.app",
  messagingSenderId: "366775652166",
  appId: "1:366775652166:web:22db16f4f87f9a60625f47",
  measurementId: "G-G09FQQ53XP"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const loginScreenEl = document.getElementById('loginScreen');
const mainAppEl = document.getElementById('mainApp');
const tryBtn = document.getElementById('tryBtn');
const googleBtn = document.getElementById('googleSignInBtn');
const emailSignInBtn = document.getElementById('emailSignInBtn');
const emailSignUpBtn = document.getElementById('emailSignUpBtn');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');

googleBtn.onclick = () => {
  const provider = new GoogleAuthProvider();
  signInWithPopup(auth, provider).then(res=>{
    showMainApp();
  }).catch(e=>alert(e.message));
}
emailSignInBtn.onclick = () => {
  signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value)
  .then(res=>showMainApp()).catch(e=>alert(e.message));
}
emailSignUpBtn.onclick = () => {
  createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value)
  .then(res=>showMainApp()).catch(e=>alert(e.message));
}

tryBtn.onclick = ()=>showMainApp();

function showMainApp(){
  loginScreenEl.style.display='none';
  mainAppEl.style.display='flex';
}

// Chat
const messagesEl = document.getElementById('chatWindow');
const promptEl = document.getElementById('prompt');
const sendBtn = document.getElementById('sendBtn');
const attachBtn = document.getElementById('attachBtn');
const fileInput = document.getElementById('fileInput');
const newChatBtn = document.getElementById('newChatBtn');
const convList = document.getElementById('conversationsList');
const userProfile = document.getElementById('userProfile');
const settingsPanel = document.getElementById('settingsPanel');
const mainContainer = document.getElementById('mainApp');

function addMessage(content,type,isImage=false){
  const div=document.createElement('div');div.className='msg '+type;
  if(isImage){const img=document.createElement('img');img.src=content;img.style.maxWidth='200px';img.style.borderRadius='12px';div.appendChild(img);}
  else div.textContent=content;
  messagesEl.appendChild(div);div.scrollIntoView({behavior:'smooth'});
  if(type==='user'){setTimeout(()=>{addMessage('BulbAI response to: '+content,'bot');},800+Math.random()*800);}
}

sendBtn.onclick=()=>{if(promptEl.value.trim()!==''){addMessage(promptEl.value,'user');promptEl.value='';}};
promptEl.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendBtn.click();}});

attachBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{if(e.target.files.length>0){addMessage(URL.createObjectURL(e.target.files[0]),'user',true);}};

newChatBtn.onclick=()=>{messagesEl.innerHTML='';};

userProfile.onclick=()=>{settingsPanel.classList.toggle('show');mainAppEl.classList.toggle('settings-open');};
document.getElementById('toggleDarkMode').onclick=()=>{document.body.classList.toggle('dark-mode');mainAppEl.classList.toggle('dark-mode');};
document.getElementById('clearChats').onclick=()=>{messagesEl.innerHTML='';};
</script>
